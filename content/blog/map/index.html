---
title: "Mapping the Number of Foreign Currency Deposit Accounts across Turkish Cities - 2010 vs. 2020"
subtitle: ""
author: Muhammet Ozkaraca
draft: false
layout: single
summary: "In this post, I visualize the number of foreign currency deposit accounts across Turkish cities between 2010 and 2020." 
date: "2021-12-20"
output:
  blogdown::html_page:
    css: styles.css
    toc: false
    number_sections: false
    toc_depth: 1
---

  <link rel="stylesheet" href="styles.css" type="text/css" />


<p>In recent years, the Turkish lira has depreciated significantly against foreign currencies. To hedge against this depreciation along with the increasing inflation, several Turkish people have converted their funds to other currencies, mainly the US dollar and the Euro. This process leads them to open bank accounts in foreign currencies. In this post, I will attempt to visualize this process by mapping the number of foreign currency accounts by Turkish cities. My analysis will entail a comparison of 2010 and 2020. To this end, I will utilize “Number of Foreign Currency Deposit Accounts” data from the <a href="https://verisistemi.tbb.org.tr/index.php?/tbb/report_bolgeler">Banks Association of Turkey</a><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. The geospatial data I will use in this post will come from the <a href="https://gadm.org/download_country.html">GADM</a>. As written in its website, please note that the GADM data cannot be used for commercial purposes.</p>
<p>In the first stage, I will download data from both sources. After tidying the <code>Number of Foreign Currency Deposit Accounts</code> data, I will merge it with the geospatial data. Finally, I will try to make the map to demonstrate the change in foreign currency deposit accounts by Turkish cities.</p>
<div id="introductory-steps" class="section level1">
<h1>Introductory Steps</h1>
<p>As a first step, I will download data from <a href="https://verisistemi.tbb.org.tr/index.php?/tbb/report_bolgeler">the Banks Association of Turkey</a>. When you click on the previous highlighted link, you will see that there are 3 main columns, namely:
<code>Geographical Regions and Provinces</code>, <code>Periods</code>, <code>Parameters</code>. Please choose <code>Select All</code> in the <code>Geographical Regions and Provinces</code> part by excluding all rows until Istanbul. In the <code>Periods</code>, we can select only 2010 and 2020 since we will only use these. Finally, in the <code>Parameters</code> part, I kindly ask you to select <code>Number of Foreign Currency Deposit Accounts</code> since this is the data we will use in this post. After that, you can click on <code>Report</code> and, by clicking on the Excel icon on the new page, you can download the data onto your computer automatically.</p>
<p>In a similar manner, let’s move on <a href="https://gadm.org/download_country.html">the GADM website</a> and please select <code>Turkey</code> from the country list, as well as click on <code>Shapefile</code> and download the data.</p>
<p>Now, let’s load the required packages and the data into our working space and start exploring the data.</p>
</div>
<div id="installing-libraries-and-the-data-into-r" class="section level1">
<h1>Installing Libraries and the data into R</h1>
<pre class="r codeBackground"><code>options(scipen=999) # to prevent scientific notation 
library(readxl) # to read excel files
library(tidyverse) # for data analysis purposes and visulization -&gt; tidyverse mainly contains ggplot2 and dplyr
library(viridis) # to make visualisations
library(sf)      # to read geospatial data</code></pre>
<p>Now, let’s install data in R and look at the head of <code>Number of Foreign Currency Deposit Accounts</code> data.</p>
</div>
<div id="section" class="section level1 panelset">
<h1 class="panelset"></h1>
<div id="code" class="section level2">
<h2>Code</h2>
<pre class="r codeBackground"><code># Be careful about where your R working directory is and where your downloaded data is located. If your data is not in the same place where your R working directory is, then R cannot read the data.

foreign_currency_accounts &lt;- read_excel(&quot;~/Desktop/PivotGrid-3.xlsx&quot;)
tur_spatial &lt;- read_sf(&quot;~/Desktop/gadm41_TUR_shp/gadm41_TUR_1.shp&quot;)
head(foreign_currency_accounts)</code></pre>
</div>
<div id="output" class="section level2">
<h2>Output</h2>
<pre class="codeBackground"><code>## # A tibble: 6 × 4
##   ...1                    ...2                `2010`        `2020`
##   &lt;chr&gt;                   &lt;chr&gt;                &lt;dbl&gt;         &lt;dbl&gt;
## 1 Döviz Tevdiat Hesapları İstanbul       79516701000 735192229941.
## 2 &lt;NA&gt;                    Adana           1558501000  18777083000 
## 3 &lt;NA&gt;                    Adıyaman         113827000   1544978000 
## 4 &lt;NA&gt;                    Afyonkarahisar   602922000   6341883000 
## 5 &lt;NA&gt;                    Ağrı             146281000    571801000 
## 6 &lt;NA&gt;                    Aksaray          720583000   5796032000</code></pre>
</div>
</div>
<div id="section-1" class="section level1">
<h1></h1>
<p>As can be seen from the output, the data frame format for the <code>Number of Foreign Currency Deposit Accounts</code> is not convenient to conduct further analysis. So, we will need a brief data cleaning effort here. Please also note that we specifically choose the <code>gadm41_TUR_1.shp</code> file to read into the working space as it contains geospatial data on the boundaries of the Turkish cities.</p>
</div>
<div id="section-2" class="section level1 panelset">
<h1 class="panelset"></h1>
<div id="code-1" class="section level2">
<h2>Code</h2>
<pre class="r codeBackground"><code>colnames(foreign_currency_accounts) &lt;- c(&quot;&quot;, &quot;cities&quot;, &quot;2010&quot;, 2020)

foreign_currency_accounts &lt;- foreign_currency_accounts %&gt;%
  select(&quot;cities&quot;, &quot;2010&quot;, &quot;2020&quot;) %&gt;%
  pivot_longer(!&quot;cities&quot;, names_to = &quot;years&quot;, values_to = &quot;account_numbers&quot;)

head(foreign_currency_accounts)</code></pre>
</div>
<div id="output-1" class="section level2">
<h2>Output</h2>
<pre class="codeBackground"><code>## # A tibble: 6 × 3
##   cities   years account_numbers
##   &lt;chr&gt;    &lt;chr&gt;           &lt;dbl&gt;
## 1 İstanbul 2010     79516701000 
## 2 İstanbul 2020    735192229941.
## 3 Adana    2010      1558501000 
## 4 Adana    2020     18777083000 
## 5 Adıyaman 2010       113827000 
## 6 Adıyaman 2020      1544978000</code></pre>
</div>
</div>
<div id="section-3" class="section level1">
<h1></h1>
<p>Let us revise what we have done so far. We first renamed the column names in our data set to as it would not lead to further misunderstandings. Then, by using <code>select</code> function from the <code>dplyr</code> package, we selected 3 crucial columns for our analysis from the main dataset. They are, namely, <code>cities</code>, <code>2010</code>, and <code>2020</code>. Following that, as we wanted the years to be stored in a new column named <code>years</code>, and the values corresponding to them in a new column named <code>account_numbers</code>, we used the powerful <code>pivot_longer</code> function from the <code>dplyr</code> package.</p>
<p><code>!"cities"</code> told R not to touch this column. <code>names_to</code> told R to store <code>2010</code>, and <code>2020</code> in a new column named <code>years</code> and the corresponding values went to the new <code>account_numbers</code> column by using <code>values_to</code> argument. Before moving on, if you want to have a further look at <code>pivot_longer()</code> function, you can try <a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">this website</a>.</p>
<p>Now, let’s focus on the <code>tur_spatial</code> data and view the data.</p>
</div>
<div id="section-4" class="section level1 panelset">
<h1 class="panelset"></h1>
<div id="code-2" class="section level2">
<h2>Code</h2>
<pre class="r codeBackground"><code>head(tur_spatial)</code></pre>
</div>
<div id="output-2" class="section level2">
<h2>Output</h2>
<pre class="codeBackground"><code>## Simple feature collection with 6 features and 11 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 29.66377 ymin: 36.53847 xmax: 44.49647 ymax: 41.09054
## Geodetic CRS:  WGS 84
## # A tibble: 6 × 12
##   GID_1   GID_0 COUNTRY NAME_1 VARNA…¹ NL_NA…² TYPE_1 ENGTY…³ CC_1  HASC_1 ISO_1
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
## 1 TUR.1_1 TUR   Turkey  Adana  Seyhan  NA      Il     Provin… NA    TR.AA  TR-01
## 2 TUR.2_1 TUR   Turkey  Adiya… Adıyam… NA      Il     Provin… NA    TR.AD  TR-02
## 3 TUR.3_1 TUR   Turkey  Afyon  Afyonk… NA      Il     Provin… NA    TR.AF  NA   
## 4 TUR.4_1 TUR   Turkey  Agri   Ağri|K… NA      Il     Provin… NA    TR.AG  TR-04
## 5 TUR.5_1 TUR   Turkey  Aksar… NA      NA      Il     Provin… NA    TR.AK  TR-68
## 6 TUR.6_1 TUR   Turkey  Amasya NA      NA      Il     Provin… NA    TR.AM  TR-05
## # … with 1 more variable: geometry &lt;MULTIPOLYGON [°]&gt;, and abbreviated variable
## #   names ¹​VARNAME_1, ²​NL_NAME_1, ³​ENGTYPE_1</code></pre>
</div>
</div>
<div id="section-5" class="section level1">
<h1></h1>
<p>Now, as a second step, we need to merge <code>Number of Foreign Currency Deposit Accounts</code> data with <code>tur_spatial</code> data so that we can have corresponding values stored for the relevant cities to make the map we are aiming for.</p>
</div>
<div id="merging-datasets" class="section level1">
<h1>Merging Datasets</h1>
<p>This step has another tricky part as it requires a careful examination with regards to Turkish cities’ names due to the punctuation differences between the two datasets we are working on. While this problem occurs because of the nature of the Turkish language, with a careful examination, we can handle this problem.</p>
</div>
<div id="section-6" class="section level1 panelset">
<h1 class="panelset"></h1>
<div id="code-3" class="section level2">
<h2>Code</h2>
<pre class="r codeBackground"><code>tur_spatial &lt;- tur_spatial %&gt;%
  mutate(NAME_1 = case_when(NAME_1 == &quot;Adiyaman&quot; ~ &quot;Adıyaman&quot;,
                            NAME_1 == &quot;Afyon&quot; ~ &quot;Afyonkarahisar&quot;,
                            NAME_1 == &quot;Agri&quot; ~ &quot;Ağrı&quot;,
                            NAME_1 == &quot;Aydin&quot; ~ &quot;Aydın&quot;,
                            NAME_1 == &quot;Balikesir&quot; ~ &quot;Balıkesir&quot;,
                            NAME_1 == &quot;Çankiri&quot; ~ &quot;Çankırı&quot;,
                            NAME_1 == &quot;Diyarbakir&quot; ~ &quot;Diyarbakır&quot;,
                            NAME_1 == &quot;Eskisehir&quot; ~ &quot;Eskişehir&quot;,
                            NAME_1 == &quot;Gümüshane&quot; ~ &quot;Gümüşhane&quot;,
                            NAME_1 == &quot;Istanbul&quot; ~ &quot;İstanbul&quot;,
                            NAME_1 == &quot;Izmir&quot; ~ &quot;İzmir&quot;,
                            NAME_1 == &quot;K. Maras&quot; ~ &quot;Kahramanmaraş&quot;,
                            NAME_1 == &quot;Kinkkale&quot; ~ &quot;Kırıkkale&quot;,
                            NAME_1 == &quot;Kirklareli&quot; ~ &quot;Kırklareli&quot;,
                            NAME_1 == &quot;Kirsehir&quot; ~ &quot;Kırşehir&quot;,
                            NAME_1 == &quot;Mersin&quot; ~ &quot;İçel&quot;,
                            NAME_1 == &quot;Mugla&quot; ~ &quot;Muğla&quot;,
                            NAME_1 == &quot;Mus&quot; ~ &quot;Muş&quot;,
                            NAME_1 == &quot;Nigde&quot; ~ &quot;Niğde&quot;,
                            NAME_1 == &quot;Sanliurfa&quot; ~ &quot;Şanlıurfa&quot;,
                            NAME_1 == &quot;Sirnak&quot; ~ &quot;Şırnak&quot;,
                            NAME_1 == &quot;Tekirdag&quot; ~ &quot;Tekirdağ&quot;,
                            NAME_1 == &quot;Usak&quot; ~ &quot;Uşak&quot;,
                            NAME_1 == &quot;Zinguldak&quot; ~ &quot;Zonguldak&quot;,
                            TRUE ~ NAME_1))

colnames(tur_spatial)[4] &lt;- &quot;cities&quot;

final_data &lt;- tur_spatial %&gt;%
  left_join(foreign_currency_accounts, by = c(&quot;cities&quot;))

quantile(final_data$account_numbers, probs = seq(0, 1, 0.25), na.rm = FALSE)</code></pre>
</div>
<div id="output-3" class="section level2">
<h2>Output</h2>
<pre class="codeOutput"><code>##           0%          25%          50%          75%         100% 
##     16087000    214470250    903586500   3665321750 735192229941</code></pre>
</div>
</div>
<div id="section-7" class="section level1">
<h1></h1>
<p>The above code solved the punctuation differences between the two datasets we are working on and merged these two datasets accordingly. To elaborate on what we have done so far, we first eliminated the punctuation differences between the two datasets using <code>case_when()</code> function and then merged them into the <code>final_data</code> we will be using to make the map.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<p>Also, note that with the <code>quantile()</code> function, we got an idea on distribution of the <code>account_numbers()</code>, which will help us to set the boundaries for the legend when we will be making the map later.</p>
</div>
<div id="visualize-the-data" class="section level1">
<h1>Visualize the Data</h1>
<p>Now, as the last step, we will visualize our data with the following code chunk;</p>
<pre class="r codeBackground"><code>plot &lt;- final_data %&gt;%
  select(years, cities, account_numbers, geometry) %&gt;%
  # filter(years == 2010) %&gt;%
  ggplot() +#
  geom_sf(aes(fill = account_numbers), color = &quot;white&quot;, lwd = 0.01) +
  facet_wrap(~years, nrow = 1) +
  theme_void() +
  labs(title = &quot;Number of Foreign Currency Deposit Accounts in Banks by Province in Turkey&quot;,
       subtitle = &quot;2010 vs. 2020&quot;,
       caption = &quot;Source: Banks Association of Turkey&quot;) +
  scale_fill_viridis(name=&quot;Total Account Number&quot;, trans = &quot;log&quot;,
                     breaks = c(16087000, 214470250, 903586500, 3665321750, 735192229941), 
                     labels = c(&quot;0-16 M&quot;, &quot;16 M- 214.5M&quot;, &quot;214.5 M - 903.6 M&quot;, &quot;903.6 M - 3.7 B&quot;, &quot;3.7 B - 7.4 B&quot;),
                     guide = guide_legend(keyheight = unit(1, units = &quot;mm&quot;), 
                                          keywidth=unit(6, units = &quot;mm&quot;), 
                                          label.position = &quot;bottom&quot;, title.position = &#39;top&#39;,
                                          nrow=1)) +
  theme(plot.background = element_rect(fill = &quot;#f5f5f2&quot;, color = NA),
        panel.background = element_rect(fill = &quot;#f5f5f2&quot;, color = NA),
        legend.background = element_rect(fill = &quot;#f5f5f2&quot;, color = NA),
        legend.text = element_text(size = 18),
        legend.title = element_text(size = 20),
        strip.text = element_text(size = 18),
        plot.title = element_text(size= 35, hjust = 0.5, color = &quot;#4e4d47&quot;),
        plot.subtitle = element_text(size= 24, hjust = 0.5, color = &quot;#4e4d47&quot;),
        plot.caption = element_text(size=24, color = &quot;#4e4d47&quot;, hjust = 0.2),
        legend.position = c(0.5, 0),
        legend.direction = &quot;horizontal&quot;) 

knitr::include_graphics(&quot;featured.png&quot;)</code></pre>
<p><img src="featured.png" width="1675" /></p>
<p>Voilà, here is our beautiful map that demonstrates a comparison of the number of foreign currency deposit accounts in Turkey between 2010 and 2020 by city-level. Before concluding our post, let us look at some specific arguments we made while making this plot.</p>
<ul>
<li>We want each city to be colored based on the corresponding number of foreign deposit accounts, so we write this <code>fill = account_numbers</code>. If you would like to adjust the transparency of the colors for each city, you can customize <code>alpha</code> argument inside <code>geom_sf()</code> function. 0 corresponds to full transparency, while 1 corresponds to full opacity.</li>
<li><code>theme_void</code> argument provides a blank background. By using <code>scale_fill_viridis</code>, we color our map. As the distribution of <code>account_numbers</code> data is not normal<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>, we can use <code>trans = "log"</code> argument to see the change between 2010 and 2020 better.</li>
<li>Without going into further details, I want to lastly point out that <code>facet_wrap()</code> function, which helps to see the comparison between the 2010 and the 2020. If you want to look further into the specifics of these arguments, <a href="https://www.r-graph-gallery.com">this website</a> has wonderful tutorials for making visualisations in R that I am sure will satisfy your needs.</li>
</ul>
<p>To conclude, in this tutorial, I tried to make a visualization that demonstrates the amount of change in foreign currency deposit accounts across cities in Turkey between 2010 and 2020. I hope this post can help you in your own endeavors. If you have further questions and suggestions, please do not hesitate to reach me via <a href="mailto:muhammetozk@icloud.com">muhammetozk@icloud.com</a>.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>In Turkish, Türkiye Bankalar Biriliği<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Although I tried to explain the steps as simple as possible, if these explanations might not be convenient for you, I would recommend you look at <a href="https://statisticsglobe.com/r-dplyr-join-inner-left-right-full-semi-anti">this website to understand how to use <code>left_join</code> function</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>we can find out this with a box plot using <code>boxplot(final_data$account_numbers)</code> code<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
